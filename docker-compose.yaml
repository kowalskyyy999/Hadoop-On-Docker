version: '3.7'

networks:
  hadoop-network:
    external: true
  hadoop:
    driver: bridge
    enable_ipv6: false

services:
  namenode:
    image: namenode:$HADOOP_VERSION
    build:
      context: ./image/namenode
      args:
        - HADOOP_VERSION=$HADOOP_VERSION
    container_name: namenode
    restart: always
    ports:
      - 9870:9870
      - 9000:9000
    networks:
      - hadoop-network
      - hadoop

  datanode1:
    image: datanode:$HADOOP_VERSION
    build: 
      context: ./image/datanode
      args:
        - HADOOP_VERSION=$HADOOP_VERSION
    container_name: datanode1
    restart: always
    depends_on:
      - namenode
    networks:
      - hadoop
      - hadoop-network

  datanode2:
    image: datanode:$HADOOP_VERSION
    build: 
      context: ./image/datanode
      args:
        - HADOOP_VERSION=$HADOOP_VERSION
    container_name: datanode2
    restart: always
    depends_on:
      - namenode
    networks:
      - hadoop
      - hadoop-network

  resourcemanager:
    image: resourcemanager:$HADOOP_VERSION
    build: 
      context: ./image/resourcemanager
      args:
        - HADOOP_VERSION=$HADOOP_VERSION
    container_name: resourcemanager
    restart: always
    ports:
      - 8088:8088
    networks:
      - hadoop-network
      - hadoop
    depends_on:
      - namenode

  nodemanager1:
    image: nodemanager:$HADOOP_VERSION
    build:
      context: ./image/nodemanager
      args:
        - HADOOP_VERSION=$HADOOP_VERSION
    container_name: nodemanager1
    restart: always
    depends_on:
      - resourcemanager
    networks:
      - hadoop
      - hadoop-network

  nodemanager2:
    image: nodemanager:$HADOOP_VERSION
    build:
      context: ./image/nodemanager
      args:
        - HADOOP_VERSION=$HADOOP_VERSION
    container_name: nodemanager2
    restart: always
    depends_on:
      - resourcemanager
    networks:
      - hadoop
      - hadoop-network